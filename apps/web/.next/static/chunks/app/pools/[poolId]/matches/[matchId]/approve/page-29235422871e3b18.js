(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7683],{2514:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var a=t(413),r=t(3353),l=t(7950),c=t(8541),n=t.n(c);let i={TOP:"탑",JGL:"정글",MID:"미드",ADC:"원딜",SUP:"서폿"},d={TOP:1,JGL:2,MID:3,ADC:4,SUP:5};function o(){let e=(0,l.useParams)(),s=(0,l.useRouter)(),t=e.poolId,c=e.matchId,[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{b()},[]);let b=async()=>{try{let e=await fetch("/api/pools/".concat(t));if(!e.ok){alert("Pool 정보를 불러오는데 실패했습니다."),s.push("/pools/".concat(t,"/matches"));return}let a=await e.json(),r=await fetch("/api/auth/me");if(r.ok){let e=await r.json();if(a.data.ownerId!==e.data.id){alert("Pool 관리자만 결과를 승인할 수 있습니다."),s.push("/pools/".concat(t,"/matches"));return}j(!0)}let l=await fetch("/api/pools/".concat(t,"/matches/").concat(c));if(l.ok){let e=(await l.json()).data;if("RESULT_PENDING"!==e.status){alert("승인 대기 중인 전적만 승인할 수 있습니다."),s.push("/pools/".concat(t,"/matches"));return}m(e)}else alert("전적을 불러오는데 실패했습니다."),s.push("/pools/".concat(t,"/matches"))}catch(e){console.error("Error:",e),alert("오류가 발생했습니다."),s.push("/pools/".concat(t,"/matches"))}finally{u(!1)}},N=e=>[...e].sort((e,s)=>(d[e.assignedPosition]||999)-(d[s.assignedPosition]||999)),f=e=>(null==o?void 0:o.userRecords)?o.userRecords.find(s=>s.userId===e):null,g=e=>{var s;if(!o||!o.gameDuration)return null;let t=o.userRecords.find(s=>s.userId===e);if(!t)return null;let a=1===t.teamNumber?2:1,r=o.userRecords.find(e=>e.teamNumber===a&&e.assignedPosition===t.assignedPosition);if(!r)return null;let l=o.team1Won&&1===t.teamNumber||!o.team1Won&&2===t.teamNumber,c=(null==(s=o.userStreaks)?void 0:s[e])||0,n=1===t.teamNumber?o.team1Kills:o.team2Kills,i=o.gameDuration/60;return function(e){let{userRecord:s,opponentRecord:t,isWinner:a,streakCount:r,gameDurationMinutes:l,teamTotalKills:c}=e,n=l;n<=0&&(n=1);let i=s.kills||0,d=s.deaths||0,o=s.assists||0,m=s.cs||0,x=t.kills||0,u=t.deaths||0,h=t.assists||0,p=t.cs||0,v=i/n,j=o/n,b=m/n,N=d/n,f=x/n,g=h/n,y=p/n,P=u/n,w=0;c>0&&(w=((i+o)/c-.5)*10);let k=(a?30:-30)+8*(2*v+ +j+.1*b-3*N-(2*f+ +g+.1*y-3*P))+w;return r>2&&a?k+=2*r:r<-2&&!a&&(k+=2*r),Math.round(k=a?Math.max(10,Math.min(50,k)):Math.max(-50,Math.min(-10,k)))}({userRecord:{...t,originalScore:t.user.score},opponentRecord:{...r,originalScore:r.user.score},isWinner:l,streakCount:c,gameDurationMinutes:i,teamTotalKills:n})},y=async()=>{if(confirm("결과를 승인하시겠습니까? 승인하면 점수가 반영되고 되돌릴 수 없습니다.")){p(!0);try{let e=await fetch("/api/pools/".concat(t,"/matches/").concat(c,"/approve"),{method:"POST"});if(e.ok)alert("결과가 승인되었습니다. 점수가 반영되었습니다."),s.push("/pools/".concat(t,"/matches"));else{let s=await e.json();alert(s.error||"승인에 실패했습니다.")}}catch(e){console.error("Error approving result:",e),alert("승인 중 오류가 발생했습니다.")}finally{p(!1)}}},P=async()=>{if(confirm("결과를 거부하시겠습니까? 거부하면 다시 결과 입력 단계로 돌아갑니다.")){p(!0);try{let e=await fetch("/api/pools/".concat(t,"/matches/").concat(c,"/reject"),{method:"POST"});if(e.ok)alert("결과가 거부되었습니다."),s.push("/pools/".concat(t,"/matches"));else{let s=await e.json();alert(s.error||"거부에 실패했습니다.")}}catch(e){console.error("Error rejecting result:",e),alert("거부 중 오류가 발생했습니다.")}finally{p(!1)}}};return x?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--primary)]"})}):o&&v?(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)(n(),{href:"/pools/".concat(t,"/matches"),className:"text-[var(--text-muted)] hover:text-[var(--text-primary)] mb-2 inline-block",children:"← 전적 목록으로 돌아가기"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-[var(--text-primary)]",children:"결과 승인"}),(0,a.jsx)("p",{className:"text-[var(--text-muted)] mt-2",children:"아래 결과를 확인하고 승인 또는 거부해주세요."})]}),(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-[var(--text-primary)] mb-4",children:"승리 팀"}),(0,a.jsx)("div",{className:"text-center py-6",children:(0,a.jsx)("div",{className:"inline-block px-8 py-4 rounded-lg text-2xl font-bold ".concat(o.team1Won?"bg-[var(--accent-purple)]/20 text-[var(--accent-purple)]":"bg-[var(--accent-blue)]/20 text-[var(--accent-blue)]"),children:o.team1Won?"Team 1 승리":"Team 2 승리"})})]}),(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-[var(--text-primary)] mb-4",children:"팀 통계"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-8 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-[var(--accent-purple)] mb-4",children:"Team 1"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-[var(--text-muted)]",children:"킬수"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-[var(--text-primary)]",children:o.team1Kills})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-[var(--text-muted)]",children:"골드"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-[var(--text-primary)]",children:o.team1Gold.toLocaleString()})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-[var(--accent-blue)] mb-4",children:"Team 2"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-[var(--text-muted)]",children:"킬수"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-[var(--text-primary)]",children:o.team2Kills})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-[var(--text-muted)]",children:"골드"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-[var(--text-primary)]",children:o.team2Gold.toLocaleString()})]})]})]})]})]}),(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-[var(--text-primary)] mb-4",children:"개별 플레이어 통계"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-[var(--accent-purple)] mb-3",children:["Team 1 ",o.team1Won&&"\uD83C\uDFC6"]}),(0,a.jsx)("div",{className:"space-y-3",children:N(o.team1Data.players).map(e=>{let s=f(e.userId),t=g(e.userId),r=(null==s?void 0:s.user.score)||0;return(0,a.jsxs)("div",{className:"bg-[var(--bg)] p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold text-[var(--accent-purple)] w-12",children:i[e.assignedPosition]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-[var(--text-primary)]",children:e.name||e.username}),(null==s?void 0:s.championName)&&(0,a.jsx)("span",{className:"text-xs text-[var(--accent-purple)] ml-2",children:s.championName})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mb-1",children:"K/D/A"}),(0,a.jsxs)("p",{className:"font-bold text-[var(--text-primary)]",children:[(null==s?void 0:s.kills)||0,"/",(null==s?void 0:s.deaths)||0,"/",(null==s?void 0:s.assists)||0]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mb-1",children:"CS"}),(0,a.jsx)("p",{className:"font-bold text-[var(--text-primary)]",children:(null==s?void 0:s.cs)||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mb-1",children:"점수"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"font-semibold text-[var(--text-primary)]",children:r}),null!==t&&(0,a.jsxs)("span",{className:"font-bold ".concat(t>0?"text-green-500":t<0?"text-red-500":"text-[var(--text-muted)]"),children:[t>0?"+":"",t]})]})]})]})]},e.userId)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-[var(--accent-blue)] mb-3",children:["Team 2 ",!o.team1Won&&"\uD83C\uDFC6"]}),(0,a.jsx)("div",{className:"space-y-3",children:N(o.team2Data.players).map(e=>{let s=f(e.userId),t=g(e.userId),r=(null==s?void 0:s.user.score)||0;return(0,a.jsxs)("div",{className:"bg-[var(--bg)] p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold text-[var(--accent-blue)] w-12",children:i[e.assignedPosition]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-[var(--text-primary)]",children:e.name||e.username}),(null==s?void 0:s.championName)&&(0,a.jsx)("span",{className:"text-xs text-[var(--accent-blue)] ml-2",children:s.championName})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mb-1",children:"K/D/A"}),(0,a.jsxs)("p",{className:"font-bold text-[var(--text-primary)]",children:[(null==s?void 0:s.kills)||0,"/",(null==s?void 0:s.deaths)||0,"/",(null==s?void 0:s.assists)||0]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mb-1",children:"CS"}),(0,a.jsx)("p",{className:"font-bold text-[var(--text-primary)]",children:(null==s?void 0:s.cs)||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--text-muted)] mb-1",children:"점수"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"font-semibold text-[var(--text-primary)]",children:r}),null!==t&&(0,a.jsxs)("span",{className:"font-bold ".concat(t>0?"text-green-500":t<0?"text-red-500":"text-[var(--text-muted)]"),children:[t>0?"+":"",t]})]})]})]})]},e.userId)})})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{onClick:P,disabled:h,className:"px-6 py-3 bg-red-500/20 text-red-500 hover:bg-red-500/30 rounded-lg font-semibold transition-colors",children:h?"처리 중...":"거부"}),(0,a.jsx)("button",{onClick:y,disabled:h,className:"btn-primary px-8 py-3",children:h?"처리 중...":"승인 및 점수 반영"})]})]}):null}},7950:(e,s,t)=>{"use strict";var a=t(3858);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},9899:(e,s,t)=>{Promise.resolve().then(t.bind(t,2514))}},e=>{e.O(0,[8541,2613,6299,7358],()=>e(e.s=9899)),_N_E=e.O()}]);