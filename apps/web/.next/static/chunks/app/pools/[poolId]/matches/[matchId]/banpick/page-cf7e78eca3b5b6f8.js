(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7382],{1885:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(413),a=r(3353),n=r(7950);function c(e){let{currentAction:t,isMyTurn:r}=e;return(0,s.jsx)("div",{className:"card mb-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-[var(--text-muted)] mb-2",children:"현재 차례"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-[var(--primary)]",children:t}),r?(0,s.jsx)("p",{className:"text-sm text-green-500 mt-2 font-semibold",children:"내 차례입니다! 챔피언을 선택하세요"}):(0,s.jsx)("p",{className:"text-sm text-[var(--text-muted)] mt-2",children:"상대방의 차례를 기다리는 중..."})]})})}function o(e){let{teamNumber:t,teamName:r,accentColor:a,session:n}=e,c=1===t?n.team1Data:n.team2Data;return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-xl font-bold ".concat(a," mb-4"),children:r}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-[var(--text-muted)] mb-2",children:["밴 (",n.bans.filter(e=>e.teamNumber===t).length,"/5)"]}),(0,s.jsx)("div",{className:"flex gap-1.5",children:Array.from({length:5}).map((e,r)=>{let a=n.bans.filter(e=>e.teamNumber===t)[r];return(0,s.jsx)("div",{className:"relative w-12 h-12 rounded border-2 border-[var(--border-color)] overflow-hidden bg-[var(--bg)] flex-shrink-0",title:(null==a?void 0:a.championName)||"밴 대기 중",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:"https://ddragon.leagueoflegends.com/cdn/15.1.1/img/champion/".concat(a.championId,".png"),alt:a.championName,className:"w-full h-full object-cover opacity-50",onError:e=>{e.currentTarget.style.display="none"}}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[var(--text-muted)] text-xs",children:"-"})},r)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-[var(--text-muted)] mb-3",children:["픽 (",n.picks.filter(e=>e.teamNumber===t).length,"/5)"]}),(0,s.jsx)("div",{className:"space-y-2",children:c.players.map(e=>{let t=n.picks.find(t=>t.userId===e.userId);return(0,s.jsx)("div",{className:"p-3 rounded bg-[var(--bg)] border border-[var(--border-color)]",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-xs ".concat(a," font-semibold min-w-[2.5rem]"),children:e.assignedPosition}),t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded overflow-hidden border border-[var(--border-color)] flex-shrink-0",children:(0,s.jsx)("img",{src:"https://ddragon.leagueoflegends.com/cdn/15.1.1/img/champion/".concat(t.championId,".png"),alt:t.championName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.style.display="none"}})}),(0,s.jsx)("span",{className:"text-[var(--text-primary)] font-semibold flex-1",children:t.championName})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded bg-[var(--surface)] border border-[var(--border-color)] flex-shrink-0 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-[var(--text-muted)] text-xs",children:"-"})}),(0,s.jsx)("span",{className:"text-[var(--text-muted)] flex-1",children:"픽 대기 중"})]})]})},e.userId)})})]})]})}function l(e){let{champions:t,session:r,searchQuery:a,onSearchChange:n,onChampionSelect:c,isMyTurn:o,actionLoading:l}=e,i=t.filter(e=>e.name.toLowerCase().includes(a.toLowerCase()));return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-[var(--text-primary)] mb-4 text-center",children:"챔피언 선택"}),(0,s.jsx)("input",{type:"text",value:a,onChange:e=>n(e.target.value),placeholder:"챔피언 검색...",className:"input w-full mb-4",disabled:!o||l}),(0,s.jsx)("div",{className:"max-h-[600px] overflow-y-auto",children:(0,s.jsx)("div",{className:"grid grid-cols-4 gap-2",children:i.map(e=>{let t=r.bans.some(t=>t.championId===e.id)||r.picks.some(t=>t.championId===e.id);return(0,s.jsxs)("button",{onClick:()=>c(e),disabled:!o||t||l,className:"relative aspect-square rounded border-2 overflow-hidden transition-all ".concat(t?"opacity-30 cursor-not-allowed border-[var(--border-color)]":o&&!l?"border-[var(--border-color)] hover:border-[var(--primary)] hover:scale-105 cursor-pointer":"border-[var(--border-color)] opacity-50 cursor-not-allowed"),title:e.name,children:[(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover"}),t&&(0,s.jsx)("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},e.id)})})}),l&&(0,s.jsxs)("div",{className:"mt-4 text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[var(--primary)] mx-auto"}),(0,s.jsx)("p",{className:"text-sm text-[var(--text-muted)] mt-2",children:"처리 중..."})]})]})}function i(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),r=e.poolId,i=e.matchId,[d,m]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[x,p]=(0,a.useState)(""),[f,v]=(0,a.useState)(!0),[b,j]=(0,a.useState)(""),[N,g]=(0,a.useState)(""),[k,y]=(0,a.useState)(!1),[w,P]=(0,a.useState)(!1),E=(0,a.useRef)(null),T=(0,a.useRef)(!1),L=(0,a.useRef)(!1);(0,a.useEffect)(()=>{d&&(E.current=d.status,L.current=!0)},[d]),(0,a.useEffect)(()=>{S(),C(),I()},[]),(0,a.useEffect)(()=>{let e=e=>{if("IN_PROGRESS"===E.current&&!T.current){console.log("[BanPick] Page unloading, leaving session"),T.current=!0;let e=new XMLHttpRequest;e.open("DELETE","/api/pools/".concat(r,"/matches/").concat(i,"/banpick/session"),!1),e.send()}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[r,i]),(0,a.useEffect)(()=>{if(d&&!w){if("IN_PROGRESS"===d.status){let e=setInterval(()=>{C()},2e3);return()=>clearInterval(e)}"COMPLETED"===d.status&&setTimeout(()=>{t.push("/pools/".concat(r,"/matches"))},3e3)}},[null==d?void 0:d.status,w]);let S=async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();g(t.data.id)}}catch(e){console.error("Error fetching user:",e)}},C=async()=>{if(w)return void console.log("[BanPick] Already completed, skipping fetch");try{let a=await fetch("/api/pools/".concat(r,"/matches/").concat(i,"/banpick/session"));if(a.ok){let n=await a.json();if(n.data){let e=n.data;"WAITING_PARTICIPANTS"===e.status?(console.log("[BanPick] Session is still waiting for participants"),m(null),j("밴픽이 아직 시작되지 않았습니다. 대기 모달에서 참여해주세요.")):"COMPLETED"===e.status?(console.log("[BanPick] Session completed"),m(e)):"IN_PROGRESS"===e.status?m(e):(console.log("[BanPick] Unknown session status:",e.status),m(null),j("알 수 없는 세션 상태입니다."))}else{var e,s;if(console.log("[BanPick] No session found - checking if completed or cancelled"),m(null),L.current){try{let s=await fetch("/api/pools/".concat(r,"/matches/").concat(i));if(s.ok&&(null==(e=(await s.json()).data)?void 0:e.status)==="DRAFT_COMPLETE"){console.log("[BanPick] Draft was completed"),P(!0),setTimeout(()=>{t.push("/pools/".concat(r,"/matches"))},3e3);return}}catch(e){console.error("[BanPick] Error checking game status:",e)}j("밴픽이 종료되었습니다. 상대방이 나갔습니다.")}else{try{let e=await fetch("/api/pools/".concat(r,"/matches/").concat(i));if(e.ok&&(null==(s=(await e.json()).data)?void 0:s.status)==="DRAFT_COMPLETE"){console.log("[BanPick] Draft already completed, redirecting"),P(!0),setTimeout(()=>{t.push("/pools/".concat(r,"/matches"))},3e3);return}}catch(e){console.error("[BanPick] Error checking game status:",e)}j("밴픽 세션을 찾을 수 없습니다.")}}}else m(null),j("밴픽 세션을 불러오는데 실패했습니다.")}catch(e){console.error("[BanPick] Error fetching session:",e),m(null),j("밴픽 세션을 불러오는 중 오류가 발생했습니다.")}finally{v(!1)}},I=async()=>{try{let e=await fetch("/api/champions");if(e.ok){let t=await e.json();h(t.data.champions)}}catch(e){console.error("Error fetching champions:",e)}},R=async()=>{if(!T.current){T.current=!0;try{console.log("[BanPick] Leaving session"),await fetch("/api/pools/".concat(r,"/matches/").concat(i,"/banpick/session"),{method:"DELETE"})}catch(e){console.error("Error leaving session:",e)}}},B=async()=>{"IN_PROGRESS"===E.current&&await R(),t.push("/pools/".concat(r,"/matches"))},M=async e=>{if(O()&&!k){y(!0);try{let s=await fetch("/api/pools/".concat(r,"/matches/").concat(i,"/banpick/action"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({championId:e.id,championName:e.name})});if(s.ok)(await s.json()).data.completed?(console.log("[BanPick] Draft completed!"),P(!0),setTimeout(()=>{t.push("/pools/".concat(r,"/matches"))},3e3)):await C();else{let e=await s.json();alert(e.error||"밴/픽에 실패했습니다.")}}catch(e){console.error("Error performing action:",e),alert("밴/픽 중 오류가 발생했습니다.")}finally{y(!1)}}},_=async()=>{confirm("밴픽을 취소하시겠습니까? 취소하면 처음부터 다시 시작해야 합니다.")&&(await R(),t.push("/pools/".concat(r,"/matches")))},O=()=>!!d&&!!N&&(1===d.currentTurn?N===d.team1ParticipantId:N===d.team2ParticipantId);return f?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--primary)]"})}):b||!d?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen px-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-[var(--error)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-[var(--text-primary)] mb-2",children:b||"세션을 불러올 수 없습니다"}),(0,s.jsx)("button",{onClick:B,className:"btn-primary mt-4",children:"전적 목록으로 돌아가기"})]})}):w?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen px-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-[var(--text-primary)] mb-2",children:"밴픽이 완료되었습니다!"}),(0,s.jsx)("p",{className:"text-[var(--text-muted)] mb-4",children:"전적 목록으로 이동 중..."})]})}):(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("button",{onClick:B,className:"text-[var(--text-muted)] hover:text-[var(--text-primary)]",children:"← 전적 목록으로 돌아가기"}),(0,s.jsx)("button",{onClick:_,className:"px-4 py-2 bg-red-500/20 text-red-500 hover:bg-red-500/30 rounded-lg font-semibold transition-colors",children:"밴픽 취소"})]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-[var(--text-primary)]",children:"밴픽 진행 중"})]}),(0,s.jsx)(c,{currentAction:(()=>{if(!d)return"";let e=d.currentStep,t=1===d.currentTurn?"Team 1":"Team 2";if(e>=0&&e<6){let e=d.bans.filter(e=>e.teamNumber===d.currentTurn).length+1;return"".concat(t," 밴 ").concat(e,"/3 (1차)")}if(e>=6&&e<12){let e=d.picks.filter(e=>e.teamNumber===d.currentTurn).length+1;return"".concat(t," 픽 ").concat(e,"/3 (1차)")}if(e>=12&&e<16){let e=d.bans.filter(e=>e.teamNumber===d.currentTurn).length+1;return"".concat(t," 밴 ").concat(e,"/5 (2차)")}if(e>=16&&e<20){let e=d.picks.filter(e=>e.teamNumber===d.currentTurn).length+1;return"".concat(t," 픽 ").concat(e,"/5 (2차)")}return"".concat(t," ").concat("BAN"===d.currentPhase?"밴":"픽")})(),isMyTurn:O()}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)(o,{teamNumber:1,teamName:"Team 1",accentColor:"text-[var(--accent-purple)]",session:d}),(0,s.jsx)(l,{champions:u,session:d,searchQuery:x,onSearchChange:p,onChampionSelect:M,isMyTurn:O(),actionLoading:k}),(0,s.jsx)(o,{teamNumber:2,teamName:"Team 2",accentColor:"text-[var(--accent-blue)]",session:d})]})]})}},7950:(e,t,r)=>{"use strict";var s=r(3858);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},8576:(e,t,r)=>{Promise.resolve().then(r.bind(r,1885))}},e=>{e.O(0,[2613,6299,7358],()=>e(e.s=8576)),_N_E=e.O()}]);